<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>String Quintet Composer - BULLETPROOF v25</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.2em;
        }
        .status-bar {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .status-item {
            display: inline-block;
            margin-right: 20px;
            padding: 5px 10px;
            background: #fff;
            border-radius: 5px;
        }
        .success { color: #28a745; font-weight: bold; }
        .warning { color: #ffc107; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .control-group {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #dee2e6;
        }
        .control-group h3 {
            color: #495057;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #6c757d;
            font-weight: 500;
        }
        input, select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .btn {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
            margin-left: 10px;
        }
        .btn-success {
            background: #28a745;
            color: white;
            margin-left: 10px;
        }
        .action-buttons {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #dee2e6;
        }
        .validation-results {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }
        .validation-item {
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .validation-pass {
            background: #d4edda;
            color: #155724;
        }
        .validation-fail {
            background: #f8d7da;
            color: #721c24;
        }
        .debug-panel {
            background: #2d3436;
            color: #dfe6e9;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        .debug-line {
            margin: 2px 0;
        }
        .filename-display {
            background: #e7f3ff;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            color: #0066cc;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>String Quintet Composer</h1>
        <div class="subtitle">BULLETPROOF Sibelius 25.4 Compatible - Version 25</div>
        
        <div class="status-bar">
            <span class="status-item">Engine: <span class="success">READY</span></span>
            <span class="status-item">Division: <span class="success">256</span></span>
            <span class="status-item">Format: <span class="success">.musicxml</span></span>
            <span class="status-item">Compatibility: <span class="success">Sibelius 25.4</span></span>
        </div>

        <div class="control-panel">
            <div class="control-group">
                <h3>‚öôÔ∏è Composition Settings</h3>
                <label for="measures">Number of Measures:</label>
                <input type="number" id="measures" value="16" min="4" max="100">
                
                <label for="tempo">Tempo (BPM):</label>
                <input type="number" id="tempo" value="120" min="40" max="200">
                
                <label for="timeSignature">Time Signature:</label>
                <select id="timeSignature">
                    <option value="4/4">4/4</option>
                    <option value="3/4">3/4</option>
                    <option value="6/8">6/8</option>
                    <option value="2/4">2/4</option>
                </select>
            </div>

            <div class="control-group">
                <h3>üéµ Musical Style</h3>
                <label for="style">Compositional Style:</label>
                <select id="style">
                    <option value="classical">Classical</option>
                    <option value="romantic">Romantic</option>
                    <option value="modern">Modern</option>
                    <option value="minimalist">Minimalist</option>
                </select>
                
                <label for="density">Note Density:</label>
                <select id="density">
                    <option value="sparse">Sparse</option>
                    <option value="moderate" selected>Moderate</option>
                    <option value="dense">Dense</option>
                </select>
                
                <label for="dynamics">Dynamic Range:</label>
                <select id="dynamics">
                    <option value="pp-p">Very Soft (pp-p)</option>
                    <option value="p-mf">Soft (p-mf)</option>
                    <option value="mf-f" selected>Medium (mf-f)</option>
                    <option value="f-ff">Loud (f-ff)</option>
                </select>
            </div>

            <div class="control-group">
                <h3>üéª Advanced Features</h3>
                <label>
                    <input type="checkbox" id="enableDoubleStops"> Enable Double Stops
                </label>
                <label>
                    <input type="checkbox" id="enableDynamics" checked> Include Dynamics
                </label>
                <label>
                    <input type="checkbox" id="enableArticulations"> Include Articulations
                </label>
                <label>
                    <input type="checkbox" id="mixedRhythms"> Mixed Rhythms
                </label>
                <label style="color: #dc3545; font-weight: bold;">
                    <input type="checkbox" id="testRanges"> TEST RANGES MODE
                </label>
            </div>
        </div>

        <div class="validation-results" id="validationResults">
            <h3>üîç Validation Results</h3>
            <div id="validationContent"></div>
        </div>

        <div class="debug-panel" id="debugPanel">
            <div id="debugContent"></div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" onclick="generateComposition()">üéº Generate String Quintet</button>
            <button class="btn btn-secondary" onclick="validateStructure()">‚úì Validate</button>
            <button class="btn btn-secondary" onclick="toggleDebug()">üîß Debug</button>
            <button class="btn btn-success" onclick="showRanges()">üìä Show Ranges</button>
        </div>

        <div class="filename-display" id="filenameDisplay" style="display: none;">
            File will be saved as: <strong id="filename"></strong>
        </div>
    </div>

    <script>
        // BULLETPROOF CONFIGURATION - DO NOT CHANGE
        const DIVISIONS = 256; // Sibelius 25.4 standard - NEVER change this
        const FILE_EXTENSION = '.musicxml'; // MUST be .musicxml for Sibelius
        
        // Global state
        let currentXML = '';
        let debugMode = false;
        
        // Instrument ranges - CORRECTED WITH PROPER MIDI VALUES
        const INSTRUMENT_RANGES = {
            'Guitar': { min: 40, max: 76, clef: 'treble' },       // E2-E5 (Classical guitar)
            'Violin 1': { min: 55, max: 100, clef: 'treble' },    // G3-E7
            'Violin 2': { min: 55, max: 100, clef: 'treble' },    // G3-E7
            'Viola': { min: 48, max: 88, clef: 'alto' },          // C3-E6
            'Cello': { min: 36, max: 81, clef: 'bass' }           // C2-A5
        };
        
        // Duration calculations - EXACT VALUES FOR SIBELIUS
        const DURATIONS = {
            'whole': DIVISIONS * 4,      // 1024
            'half': DIVISIONS * 2,       // 512
            'quarter': DIVISIONS,        // 256
            'eighth': DIVISIONS / 2,     // 128
            'sixteenth': DIVISIONS / 4   // 64
        };
        
        function debugLog(message) {
            if (!debugMode) return;
            const debugContent = document.getElementById('debugContent');
            const line = document.createElement('div');
            line.className = 'debug-line';
            line.textContent = `[${new Date().toISOString()}] ${message}`;
            debugContent.appendChild(line);
            debugContent.scrollTop = debugContent.scrollHeight;
        }
        
        function toggleDebug() {
            debugMode = !debugMode;
            const panel = document.getElementById('debugPanel');
            panel.style.display = debugMode ? 'block' : 'none';
            if (debugMode) {
                debugLog('Debug mode activated');
                debugLog(`Divisions: ${DIVISIONS}`);
                debugLog(`File extension: ${FILE_EXTENSION}`);
            }
        }
        
        function midiToNote(midi) {
            const noteNames = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
            // CORRECTED: MIDI 60 = C4 (middle C)
            const octave = Math.floor(midi / 12) - 1;
            const noteIndex = midi % 12;
            const noteName = noteNames[noteIndex];
            
            // Convert to MusicXML format
            const step = noteName.replace('#', '');
            const alter = noteName.includes('#') ? 1 : 0;
            
            // Debug output for verification
            if (debugMode) {
                const noteString = `${noteName}${octave}`;
                debugLog(`MIDI ${midi} -> ${noteString}`);
            }
            
            return { step, alter, octave };
        }
        
        function showRanges() {
            let rangeInfo = 'INSTRUMENT RANGES (MIDI -> Note):\n\n';
            
            Object.entries(INSTRUMENT_RANGES).forEach(([name, range]) => {
                const lowNote = midiToNote(range.min);
                const highNote = midiToNote(range.max);
                const lowName = `${lowNote.step}${lowNote.alter ? '#' : ''}${lowNote.octave}`;
                const highName = `${highNote.step}${highNote.alter ? '#' : ''}${highNote.octave}`;
                
                rangeInfo += `${name}:\n`;
                rangeInfo += `  MIDI ${range.min}-${range.max}\n`;
                rangeInfo += `  Notes: ${lowName} to ${highName}\n`;
                rangeInfo += `  Clef: ${range.clef}\n\n`;
            });
            
            alert(rangeInfo);
            
            // Also log to debug panel if open
            debugLog('=== RANGE INFORMATION ===');
            Object.entries(INSTRUMENT_RANGES).forEach(([name, range]) => {
                debugLog(`${name}: MIDI ${range.min}-${range.max}, Clef: ${range.clef}`);
            });
        }
        
        function generateNoteXML(midi, duration, noteType, isChord = false, articulation = null) {
            const note = midiToNote(midi);
            let xml = '<note>';
            
            // CRITICAL: chord element must come FIRST after <note>
            if (isChord) {
                xml += '<chord/>';
            }
            
            xml += '<pitch>';
            xml += `<step>${note.step}</step>`;
            if (note.alter) {
                xml += `<alter>${note.alter}</alter>`;
            }
            xml += `<octave>${note.octave}</octave>`;
            xml += '</pitch>';
            xml += `<duration>${duration}</duration>`;
            xml += '<voice>1</voice>';
            xml += `<type>${noteType}</type>`;
            
            // Add articulation if specified
            if (articulation) {
                xml += '<notations>';
                xml += '<articulations>';
                xml += `<${articulation}/>`;
                xml += '</articulations>';
                xml += '</notations>';
            }
            
            xml += '</note>';
            return xml;
        }
        
        function generateMeasureContent(instrumentName, measureNum) {
            const range = INSTRUMENT_RANGES[instrumentName];
            const enableDoubleStops = document.getElementById('enableDoubleStops').checked;
            const mixedRhythms = document.getElementById('mixedRhythms').checked;
            const testRanges = document.getElementById('testRanges').checked;
            const enableArticulations = document.getElementById('enableArticulations').checked;
            
            let xml = '';
            
            debugLog(`Generating measure ${measureNum} for ${instrumentName}`);
            
            if (testRanges) {
                // Test mode: specific notes to verify ranges
                let testMidi;
                if (measureNum === 1) {
                    // First measure: lowest note
                    testMidi = range.min;
                    debugLog(`${instrumentName}: Testing LOWEST note - MIDI ${testMidi}`);
                } else if (measureNum === 2) {
                    // Second measure: middle note
                    testMidi = Math.floor((range.min + range.max) / 2);
                    debugLog(`${instrumentName}: Testing MIDDLE note - MIDI ${testMidi}`);
                } else if (measureNum === 3) {
                    // Third measure: highest note
                    testMidi = range.max;
                    debugLog(`${instrumentName}: Testing HIGHEST note - MIDI ${testMidi}`);
                } else {
                    // After measure 3: chromatic scale from low to high
                    const scalePosition = (measureNum - 4) % (range.max - range.min + 1);
                    testMidi = Math.min(range.min + scalePosition, range.max);
                    debugLog(`${instrumentName}: Testing scale position - MIDI ${testMidi}`);
                }
                
                // Generate whole notes for clarity in test mode
                xml += generateNoteXML(testMidi, DURATIONS.whole, 'whole', false);
                
            } else {
                // Normal mode: generate music with all features
                let remainingDuration = DIVISIONS * 4; // Full measure in 4/4
                
                while (remainingDuration > 0) {
                    // Choose rhythm - actually use mixed rhythms when enabled!
                    let duration, noteType;
                    
                    if (mixedRhythms) {
                        // Mixed rhythm mode - use variety
                        const rhythmChoice = Math.random();
                        if (rhythmChoice < 0.15 && remainingDuration >= DURATIONS.whole) {
                            duration = DURATIONS.whole;
                            noteType = 'whole';
                        } else if (rhythmChoice < 0.35 && remainingDuration >= DURATIONS.half) {
                            duration = DURATIONS.half;
                            noteType = 'half';
                        } else if (rhythmChoice < 0.70 && remainingDuration >= DURATIONS.quarter) {
                            duration = DURATIONS.quarter;
                            noteType = 'quarter';
                        } else if (remainingDuration >= DURATIONS.eighth) {
                            duration = DURATIONS.eighth;
                            noteType = 'eighth';
                        } else {
                            // Fill remaining space
                            duration = remainingDuration;
                            if (duration >= DURATIONS.quarter) {
                                noteType = 'quarter';
                            } else if (duration >= DURATIONS.eighth) {
                                noteType = 'eighth';
                            } else {
                                noteType = 'sixteenth';
                            }
                        }
                    } else {
                        // Simple mode - mostly quarters
                        if (remainingDuration >= DURATIONS.quarter) {
                            duration = DURATIONS.quarter;
                            noteType = 'quarter';
                        } else {
                            duration = remainingDuration;
                            noteType = 'eighth';
                        }
                    }
                    
                    // Ensure we don't exceed measure
                    if (duration > remainingDuration) {
                        duration = remainingDuration;
                        // Determine correct note type for remaining duration
                        if (duration === DURATIONS.whole) noteType = 'whole';
                        else if (duration === DURATIONS.half) noteType = 'half';
                        else if (duration === DURATIONS.quarter) noteType = 'quarter';
                        else if (duration === DURATIONS.eighth) noteType = 'eighth';
                        else noteType = 'sixteenth';
                    }
                    
                    // Generate note(s) - ENSURE within range
                    const midi = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
                    
                    // Validate MIDI is actually in range
                    if (midi < range.min || midi > range.max) {
                        debugLog(`WARNING: MIDI ${midi} out of range for ${instrumentName}!`);
                    }
                    
                    // Choose articulation if enabled
                    let articulation = null;
                    if (enableArticulations && Math.random() < 0.2) {
                        const articulations = ['staccato', 'accent', 'tenuto'];
                        articulation = articulations[Math.floor(Math.random() * articulations.length)];
                    }
                    
                    xml += generateNoteXML(midi, duration, noteType, false, articulation);
                    
                    // Add double stops for strings (not guitar or cello)
                    if (enableDoubleStops && Math.random() < 0.15 && 
                        instrumentName !== 'Cello' && instrumentName !== 'Guitar') {
                        const interval = 3 + Math.floor(Math.random() * 5);
                        const midi2 = Math.min(range.max, midi + interval);
                        xml += generateNoteXML(midi2, duration, noteType, true, articulation);
                    }
                    
                    remainingDuration -= duration;
                }
            }
            
            return xml;
        }
        
        function generatePart(instrumentName, partId, measureCount) {
            let xml = `<part id="${partId}">`;
            
            // First measure with attributes
            xml += '<measure number="1">';
            xml += '<attributes>';
            xml += `<divisions>${DIVISIONS}</divisions>`;
            xml += '<key><fifths>0</fifths></key>';
            xml += '<time><beats>4</beats><beat-type>4</beat-type></time>';
            
            // Clef based on instrument
            const clef = INSTRUMENT_RANGES[instrumentName].clef;
            if (clef === 'treble') {
                xml += '<clef><sign>G</sign><line>2</line></clef>';
            } else if (clef === 'alto') {
                xml += '<clef><sign>C</sign><line>3</line></clef>';
            } else if (clef === 'bass') {
                xml += '<clef><sign>F</sign><line>4</line></clef>';
            }
            
            xml += '</attributes>';
            
            // Add tempo to first part only
            if (partId === 'P1') {
                const tempo = document.getElementById('tempo').value;
                xml += '<direction placement="above">';
                xml += '<direction-type>';
                xml += `<metronome><beat-unit>quarter</beat-unit><per-minute>${tempo}</per-minute></metronome>`;
                xml += '</direction-type>';
                xml += '</direction>';
            }
            
            // Add initial dynamic if enabled
            const enableDynamics = document.getElementById('enableDynamics').checked;
            if (enableDynamics && !document.getElementById('testRanges').checked) {
                const dynamics = ['pp', 'p', 'mp', 'mf', 'f'];
                const dynamic = dynamics[Math.floor(Math.random() * dynamics.length)];
                xml += '<direction placement="below">';
                xml += '<direction-type>';
                xml += `<dynamics><${dynamic}/></dynamics>`;
                xml += '</direction-type>';
                xml += '</direction>';
            }
            
            // Generate notes for first measure
            xml += generateMeasureContent(instrumentName, 1);
            xml += '</measure>';
            
            // Generate remaining measures
            for (let m = 2; m <= measureCount; m++) {
                xml += `<measure number="${m}">`;
                
                // Occasionally add dynamics changes in normal mode
                if (enableDynamics && !document.getElementById('testRanges').checked && Math.random() < 0.1) {
                    const dynamics = ['pp', 'p', 'mp', 'mf', 'f', 'ff'];
                    const dynamic = dynamics[Math.floor(Math.random() * dynamics.length)];
                    xml += '<direction placement="below">';
                    xml += '<direction-type>';
                    xml += `<dynamics><${dynamic}/></dynamics>`;
                    xml += '</direction-type>';
                    xml += '</direction>';
                }
                
                xml += generateMeasureContent(instrumentName, m);
                xml += '</measure>';
            }
            
            xml += '</part>';
            return xml;
        }
        
        function generateComposition() {
            debugLog('Starting composition generation...');
            
            const measureCount = parseInt(document.getElementById('measures').value);
            const tempo = parseInt(document.getElementById('tempo').value);
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            
            // Build MusicXML - EXACT FORMAT FOR SIBELIUS
            let xml = '<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n';
            xml += '<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd">\n';
            xml += '<score-partwise version="3.1">\n';
            
            // Work information
            xml += '<work><work-title>String Quintet</work-title></work>\n';
            
            // Identification
            xml += '<identification>\n';
            xml += '<creator type="composer">GML Quintet Composer v25</creator>\n';
            xml += '<encoding>\n';
            xml += '<software>GML String Quintet Composer - Bulletproof Edition</software>\n';
            xml += `<encoding-date>${new Date().toISOString().split('T')[0]}</encoding-date>\n`;
            xml += '<supports element="accidental" type="yes"/>\n';
            xml += '<supports element="beam" type="yes"/>\n';
            xml += '<supports element="stem" type="yes"/>\n';
            xml += '</encoding>\n';
            xml += '</identification>\n';
            
            // Part list
            xml += '<part-list>\n';
            const instruments = ['Guitar', 'Violin 1', 'Violin 2', 'Viola', 'Cello'];
            instruments.forEach((name, index) => {
                const partId = `P${index + 1}`;
                xml += `<score-part id="${partId}">\n`;
                xml += `<part-name>${name}</part-name>\n`;
                xml += '</score-part>\n';
            });
            xml += '</part-list>\n';
            
            // Generate parts
            instruments.forEach((name, index) => {
                const partId = `P${index + 1}`;
                xml += generatePart(name, partId, measureCount);
            });
            
            xml += '</score-partwise>';
            
            currentXML = xml;
            
            // Show filename
            const filename = `quintet_${timestamp}${FILE_EXTENSION}`;
            document.getElementById('filename').textContent = filename;
            document.getElementById('filenameDisplay').style.display = 'block';
            
            // Auto-validate
            validateStructure();
            
            // Download file
            setTimeout(() => {
                downloadXML(filename);
            }, 500);
            
            debugLog('Composition generated successfully!');
        }
        
        function downloadXML(filename) {
            const blob = new Blob([currentXML], { 
                type: 'application/vnd.recordare.musicxml+xml' 
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            debugLog(`File downloaded: ${filename}`);
        }
        
        function validateStructure() {
            if (!currentXML) {
                alert('Please generate a composition first!');
                return;
            }
            
            const results = document.getElementById('validationResults');
            const content = document.getElementById('validationContent');
            content.innerHTML = '';
            
            const checks = [
                {
                    name: 'File Extension',
                    test: () => document.getElementById('filename').textContent.endsWith('.musicxml'),
                    message: 'File has correct .musicxml extension'
                },
                {
                    name: 'XML Declaration',
                    test: () => currentXML.startsWith('<?xml version="1.0"'),
                    message: 'Valid XML declaration present'
                },
                {
                    name: 'MusicXML DOCTYPE',
                    test: () => currentXML.includes('<!DOCTYPE score-partwise'),
                    message: 'MusicXML DOCTYPE declaration present'
                },
                {
                    name: 'Divisions Setting',
                    test: () => currentXML.includes(`<divisions>${DIVISIONS}</divisions>`),
                    message: `Divisions set to ${DIVISIONS} (Sibelius standard)`
                },
                {
                    name: 'Part Count',
                    test: () => (currentXML.match(/<score-part/g) || []).length === 5,
                    message: 'All 5 parts present'
                },
                {
                    name: 'Clef Definitions',
                    test: () => currentXML.includes('<clef>'),
                    message: 'Clef definitions present'
                },
                {
                    name: 'Note Structure',
                    test: () => currentXML.includes('<pitch>') && currentXML.includes('<duration>'),
                    message: 'Notes have pitch and duration'
                },
                {
                    name: 'Measure Numbers',
                    test: () => currentXML.includes('measure number='),
                    message: 'Measures are numbered'
                }
            ];
            
            let allPassed = true;
            checks.forEach(check => {
                const passed = check.test();
                allPassed = allPassed && passed;
                
                const div = document.createElement('div');
                div.className = `validation-item ${passed ? 'validation-pass' : 'validation-fail'}`;
                div.innerHTML = `${passed ? '‚úì' : '‚úó'} ${check.name}: ${check.message}`;
                content.appendChild(div);
            });
            
            if (allPassed) {
                const summary = document.createElement('div');
                summary.className = 'validation-item validation-pass';
                summary.innerHTML = '<strong>‚úì ALL CHECKS PASSED - Ready for Sibelius 25.4!</strong>';
                summary.style.marginTop = '10px';
                content.appendChild(summary);
            }
            
            results.style.display = 'block';
            debugLog(`Validation complete: ${allPassed ? 'PASSED' : 'FAILED'}`);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('String Quintet Composer v25 - BULLETPROOF Edition');
            console.log(`Divisions: ${DIVISIONS}`);
            console.log(`File format: ${FILE_EXTENSION}`);
            console.log('Ready for Sibelius 25.4');
        });
    </script>
</body>
</html>