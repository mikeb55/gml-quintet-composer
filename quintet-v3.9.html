<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quintet Composer V3.9 - Section-Centric Interface</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .version {
            font-size: 0.9em;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .main-controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .sections-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .section-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .section-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.25);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .section-title {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }
        
        .section-enabled {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-enabled input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .section-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .full-width {
            grid-column: span 2;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        label {
            font-size: 0.85em;
            color: #555;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        select, input[type="number"] {
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 0.95em;
            transition: border-color 0.3s ease;
            background: white;
        }
        
        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .instruments-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .instruments-title {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .instrument-row {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }
        
        .instrument-label {
            font-weight: 600;
            color: #666;
            font-size: 0.9em;
        }
        
        .polyrhythm-section {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        
        .polyrhythm-title {
            font-size: 1.1em;
            color: #e65100;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .generate-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .generate-button:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }
        
        .generate-button:active {
            transform: scale(0.98);
        }
        
        #output {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        
        #xmlOutput {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .copy-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s ease;
        }
        
        .copy-button:hover {
            background: #45a049;
        }
        
        .section-disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .chord-progression-input {
            width: 100%;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .help-text {
            font-size: 0.8em;
            color: #888;
            margin-top: 3px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸŽ¼ Quintet Composer</h1>
        <div class="version">Version 3.9 - Section-Centric Interface with Polyrhythmic Capabilities</div>
    </div>

    <div class="main-controls">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
            <div class="control-group">
                <label>Title</label>
                <input type="text" id="title" value="Quintet in Multiple Styles" style="padding: 8px; border: 2px solid #e0e0e0; border-radius: 5px;">
            </div>
            <div class="control-group">
                <label>Composer</label>
                <input type="text" id="composer" value="Mike Bryant" style="padding: 8px; border: 2px solid #e0e0e0; border-radius: 5px;">
            </div>
            <div class="control-group">
                <label>Measures per Section</label>
                <input type="number" id="measuresPerSection" value="4" min="1" max="16">
            </div>
        </div>
    </div>

    <div class="sections-container">
        <!-- Section A -->
        <div class="section-card" id="sectionA">
            <div class="section-header">
                <div class="section-title">Section A</div>
                <div class="section-enabled">
                    <label>Enabled</label>
                    <input type="checkbox" id="sectionA-enabled" checked onchange="toggleSection('A')">
                </div>
            </div>
            
            <div class="section-content" id="sectionA-content">
                <div class="section-grid">
                    <div class="control-group">
                        <label>Tempo (BPM)</label>
                        <input type="number" id="sectionA-tempo" value="120" min="40" max="200">
                    </div>
                    <div class="control-group">
                        <label>Time Signature</label>
                        <select id="sectionA-timeSig">
                            <option value="4/4">4/4</option>
                            <option value="3/4">3/4</option>
                            <option value="6/8">6/8</option>
                            <option value="5/4">5/4</option>
                            <option value="7/8">7/8</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Key</label>
                        <select id="sectionA-key">
                            <option value="C">C Major</option>
                            <option value="G">G Major</option>
                            <option value="D">D Major</option>
                            <option value="A">A Major</option>
                            <option value="E">E Major</option>
                            <option value="F">F Major</option>
                            <option value="Bb">Bâ™­ Major</option>
                            <option value="Am">A Minor</option>
                            <option value="Em">E Minor</option>
                            <option value="Dm">D Minor</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Scale Type</label>
                        <select id="sectionA-scale">
                            <option value="major">Major</option>
                            <option value="minor">Natural Minor</option>
                            <option value="harmonic-minor">Harmonic Minor</option>
                            <option value="dorian">Dorian</option>
                            <option value="phrygian">Phrygian</option>
                            <option value="lydian">Lydian</option>
                            <option value="mixolydian">Mixolydian</option>
                            <option value="pentatonic">Pentatonic</option>
                            <option value="blues">Blues</option>
                            <option value="chromatic">Chromatic</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Dynamics</label>
                        <select id="sectionA-dynamics">
                            <option value="pp">pp (pianissimo)</option>
                            <option value="p">p (piano)</option>
                            <option value="mp">mp (mezzo-piano)</option>
                            <option value="mf" selected>mf (mezzo-forte)</option>
                            <option value="f">f (forte)</option>
                            <option value="ff">ff (fortissimo)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Style</label>
                        <select id="sectionA-style">
                            <option value="classical">Classical</option>
                            <option value="romantic">Romantic</option>
                            <option value="impressionist">Impressionist</option>
                            <option value="modern">Modern</option>
                            <option value="jazz">Jazz</option>
                            <option value="folk">Folk</option>
                            <option value="minimalist">Minimalist</option>
                        </select>
                    </div>
                    <div class="control-group full-width">
                        <label>Chord Progression</label>
                        <input type="text" id="sectionA-chords" class="chord-progression-input" value="I-V-vi-IV" placeholder="e.g., I-V-vi-IV or C-G-Am-F">
                        <div class="help-text">Use Roman numerals or chord names</div>
                    </div>
                </div>

                <div class="instruments-section">
                    <div class="instruments-title">Instrument Settings</div>
                    <div class="instrument-row">
                        <div class="instrument-label">Guitar:</div>
                        <select id="sectionA-guitar">
                            <option value="strum">Strumming</option>
                            <option value="fingerpicking">Fingerpicking</option>
                            <option value="arpeggios">Arpeggios</option>
                            <option value="powerchords">Power Chords</option>
                            <option value="melodic">Melodic</option>
                            <option value="muted">Muted</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Violin I:</div>
                        <select id="sectionA-violin1">
                            <option value="legato">Legato</option>
                            <option value="staccato">Staccato</option>
                            <option value="tremolo">Tremolo</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="melodic">Melodic Lead</option>
                            <option value="harmonic">Harmonics</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Violin II:</div>
                        <select id="sectionA-violin2">
                            <option value="harmony">Harmony</option>
                            <option value="counter">Counter Melody</option>
                            <option value="rhythmic">Rhythmic</option>
                            <option value="tremolo">Tremolo</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="doubling">Doubling</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Viola:</div>
                        <select id="sectionA-viola">
                            <option value="sustained">Sustained</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="rhythmic">Rhythmic</option>
                            <option value="melodic">Melodic</option>
                            <option value="tremolo">Tremolo</option>
                            <option value="harmonic">Inner Harmony</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Cello:</div>
                        <select id="sectionA-cello">
                            <option value="bassline">Bass Line</option>
                            <option value="arco">Arco Sustained</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="melodic">Melodic</option>
                            <option value="pedal">Pedal Tones</option>
                            <option value="walking">Walking Bass</option>
                        </select>
                    </div>
                </div>

                <div class="polyrhythm-section">
                    <div class="polyrhythm-title">Polyrhythmic Settings</div>
                    <div class="section-grid">
                        <div class="control-group">
                            <label>Enable Polyrhythm</label>
                            <input type="checkbox" id="sectionA-polyrhythm" style="width: 20px; height: 20px;">
                        </div>
                        <div class="control-group">
                            <label>Pattern</label>
                            <select id="sectionA-polyPattern">
                                <option value="3:2">3:2 (Triplets over Duplets)</option>
                                <option value="4:3">4:3 (Four over Three)</option>
                                <option value="5:4">5:4 (Five over Four)</option>
                                <option value="7:4">7:4 (Seven over Four)</option>
                                <option value="5:3">5:3 (Five over Three)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section B -->
        <div class="section-card" id="sectionB">
            <div class="section-header">
                <div class="section-title">Section B</div>
                <div class="section-enabled">
                    <label>Enabled</label>
                    <input type="checkbox" id="sectionB-enabled" checked onchange="toggleSection('B')">
                </div>
            </div>
            
            <div class="section-content" id="sectionB-content">
                <div class="section-grid">
                    <div class="control-group">
                        <label>Tempo (BPM)</label>
                        <input type="number" id="sectionB-tempo" value="100" min="40" max="200">
                    </div>
                    <div class="control-group">
                        <label>Time Signature</label>
                        <select id="sectionB-timeSig">
                            <option value="4/4">4/4</option>
                            <option value="3/4" selected>3/4</option>
                            <option value="6/8">6/8</option>
                            <option value="5/4">5/4</option>
                            <option value="7/8">7/8</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Key</label>
                        <select id="sectionB-key">
                            <option value="C">C Major</option>
                            <option value="G">G Major</option>
                            <option value="D">D Major</option>
                            <option value="A">A Major</option>
                            <option value="E">E Major</option>
                            <option value="F" selected>F Major</option>
                            <option value="Bb">Bâ™­ Major</option>
                            <option value="Am">A Minor</option>
                            <option value="Em">E Minor</option>
                            <option value="Dm">D Minor</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Scale Type</label>
                        <select id="sectionB-scale">
                            <option value="major">Major</option>
                            <option value="minor">Natural Minor</option>
                            <option value="harmonic-minor">Harmonic Minor</option>
                            <option value="dorian" selected>Dorian</option>
                            <option value="phrygian">Phrygian</option>
                            <option value="lydian">Lydian</option>
                            <option value="mixolydian">Mixolydian</option>
                            <option value="pentatonic">Pentatonic</option>
                            <option value="blues">Blues</option>
                            <option value="chromatic">Chromatic</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Dynamics</label>
                        <select id="sectionB-dynamics">
                            <option value="pp">pp (pianissimo)</option>
                            <option value="p" selected>p (piano)</option>
                            <option value="mp">mp (mezzo-piano)</option>
                            <option value="mf">mf (mezzo-forte)</option>
                            <option value="f">f (forte)</option>
                            <option value="ff">ff (fortissimo)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Style</label>
                        <select id="sectionB-style">
                            <option value="classical">Classical</option>
                            <option value="romantic" selected>Romantic</option>
                            <option value="impressionist">Impressionist</option>
                            <option value="modern">Modern</option>
                            <option value="jazz">Jazz</option>
                            <option value="folk">Folk</option>
                            <option value="minimalist">Minimalist</option>
                        </select>
                    </div>
                    <div class="control-group full-width">
                        <label>Chord Progression</label>
                        <input type="text" id="sectionB-chords" class="chord-progression-input" value="I-vi-ii-V" placeholder="e.g., I-V-vi-IV or C-G-Am-F">
                        <div class="help-text">Use Roman numerals or chord names</div>
                    </div>
                </div>

                <div class="instruments-section">
                    <div class="instruments-title">Instrument Settings</div>
                    <div class="instrument-row">
                        <div class="instrument-label">Guitar:</div>
                        <select id="sectionB-guitar">
                            <option value="strum">Strumming</option>
                            <option value="fingerpicking" selected>Fingerpicking</option>
                            <option value="arpeggios">Arpeggios</option>
                            <option value="powerchords">Power Chords</option>
                            <option value="melodic">Melodic</option>
                            <option value="muted">Muted</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Violin I:</div>
                        <select id="sectionB-violin1">
                            <option value="legato" selected>Legato</option>
                            <option value="staccato">Staccato</option>
                            <option value="tremolo">Tremolo</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="melodic">Melodic Lead</option>
                            <option value="harmonic">Harmonics</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Violin II:</div>
                        <select id="sectionB-violin2">
                            <option value="harmony" selected>Harmony</option>
                            <option value="counter">Counter Melody</option>
                            <option value="rhythmic">Rhythmic</option>
                            <option value="tremolo">Tremolo</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="doubling">Doubling</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Viola:</div>
                        <select id="sectionB-viola">
                            <option value="sustained" selected>Sustained</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="rhythmic">Rhythmic</option>
                            <option value="melodic">Melodic</option>
                            <option value="tremolo">Tremolo</option>
                            <option value="harmonic">Inner Harmony</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Cello:</div>
                        <select id="sectionB-cello">
                            <option value="bassline">Bass Line</option>
                            <option value="arco" selected>Arco Sustained</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="melodic">Melodic</option>
                            <option value="pedal">Pedal Tones</option>
                            <option value="walking">Walking Bass</option>
                        </select>
                    </div>
                </div>

                <div class="polyrhythm-section">
                    <div class="polyrhythm-title">Polyrhythmic Settings</div>
                    <div class="section-grid">
                        <div class="control-group">
                            <label>Enable Polyrhythm</label>
                            <input type="checkbox" id="sectionB-polyrhythm" style="width: 20px; height: 20px;">
                        </div>
                        <div class="control-group">
                            <label>Pattern</label>
                            <select id="sectionB-polyPattern">
                                <option value="3:2">3:2 (Triplets over Duplets)</option>
                                <option value="4:3">4:3 (Four over Three)</option>
                                <option value="5:4">5:4 (Five over Four)</option>
                                <option value="7:4">7:4 (Seven over Four)</option>
                                <option value="5:3">5:3 (Five over Three)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section C -->
        <div class="section-card" id="sectionC">
            <div class="section-header">
                <div class="section-title">Section C</div>
                <div class="section-enabled">
                    <label>Enabled</label>
                    <input type="checkbox" id="sectionC-enabled" checked onchange="toggleSection('C')">
                </div>
            </div>
            
            <div class="section-content" id="sectionC-content">
                <div class="section-grid">
                    <div class="control-group">
                        <label>Tempo (BPM)</label>
                        <input type="number" id="sectionC-tempo" value="140" min="40" max="200">
                    </div>
                    <div class="control-group">
                        <label>Time Signature</label>
                        <select id="sectionC-timeSig">
                            <option value="4/4">4/4</option>
                            <option value="3/4">3/4</option>
                            <option value="6/8" selected>6/8</option>
                            <option value="5/4">5/4</option>
                            <option value="7/8">7/8</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Key</label>
                        <select id="sectionC-key">
                            <option value="C">C Major</option>
                            <option value="G">G Major</option>
                            <option value="D">D Major</option>
                            <option value="A">A Major</option>
                            <option value="E">E Major</option>
                            <option value="F">F Major</option>
                            <option value="Bb">Bâ™­ Major</option>
                            <option value="Am" selected>A Minor</option>
                            <option value="Em">E Minor</option>
                            <option value="Dm">D Minor</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Scale Type</label>
                        <select id="sectionC-scale">
                            <option value="major">Major</option>
                            <option value="minor" selected>Natural Minor</option>
                            <option value="harmonic-minor">Harmonic Minor</option>
                            <option value="dorian">Dorian</option>
                            <option value="phrygian">Phrygian</option>
                            <option value="lydian">Lydian</option>
                            <option value="mixolydian">Mixolydian</option>
                            <option value="pentatonic">Pentatonic</option>
                            <option value="blues">Blues</option>
                            <option value="chromatic">Chromatic</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Dynamics</label>
                        <select id="sectionC-dynamics">
                            <option value="pp">pp (pianissimo)</option>
                            <option value="p">p (piano)</option>
                            <option value="mp">mp (mezzo-piano)</option>
                            <option value="mf">mf (mezzo-forte)</option>
                            <option value="f" selected>f (forte)</option>
                            <option value="ff">ff (fortissimo)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Style</label>
                        <select id="sectionC-style">
                            <option value="classical">Classical</option>
                            <option value="romantic">Romantic</option>
                            <option value="impressionist">Impressionist</option>
                            <option value="modern" selected>Modern</option>
                            <option value="jazz">Jazz</option>
                            <option value="folk">Folk</option>
                            <option value="minimalist">Minimalist</option>
                        </select>
                    </div>
                    <div class="control-group full-width">
                        <label>Chord Progression</label>
                        <input type="text" id="sectionC-chords" class="chord-progression-input" value="i-VI-III-VII" placeholder="e.g., I-V-vi-IV or C-G-Am-F">
                        <div class="help-text">Use Roman numerals or chord names</div>
                    </div>
                </div>

                <div class="instruments-section">
                    <div class="instruments-title">Instrument Settings</div>
                    <div class="instrument-row">
                        <div class="instrument-label">Guitar:</div>
                        <select id="sectionC-guitar">
                            <option value="strum">Strumming</option>
                            <option value="fingerpicking">Fingerpicking</option>
                            <option value="arpeggios">Arpeggios</option>
                            <option value="powerchords" selected>Power Chords</option>
                            <option value="melodic">Melodic</option>
                            <option value="muted">Muted</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Violin I:</div>
                        <select id="sectionC-violin1">
                            <option value="legato">Legato</option>
                            <option value="staccato" selected>Staccato</option>
                            <option value="tremolo">Tremolo</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="melodic">Melodic Lead</option>
                            <option value="harmonic">Harmonics</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Violin II:</div>
                        <select id="sectionC-violin2">
                            <option value="harmony">Harmony</option>
                            <option value="counter">Counter Melody</option>
                            <option value="rhythmic" selected>Rhythmic</option>
                            <option value="tremolo">Tremolo</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="doubling">Doubling</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Viola:</div>
                        <select id="sectionC-viola">
                            <option value="sustained">Sustained</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="rhythmic" selected>Rhythmic</option>
                            <option value="melodic">Melodic</option>
                            <option value="tremolo">Tremolo</option>
                            <option value="harmonic">Inner Harmony</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Cello:</div>
                        <select id="sectionC-cello">
                            <option value="bassline" selected>Bass Line</option>
                            <option value="arco">Arco Sustained</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="melodic">Melodic</option>
                            <option value="pedal">Pedal Tones</option>
                            <option value="walking">Walking Bass</option>
                        </select>
                    </div>
                </div>

                <div class="polyrhythm-section">
                    <div class="polyrhythm-title">Polyrhythmic Settings</div>
                    <div class="section-grid">
                        <div class="control-group">
                            <label>Enable Polyrhythm</label>
                            <input type="checkbox" id="sectionC-polyrhythm" checked style="width: 20px; height: 20px;">
                        </div>
                        <div class="control-group">
                            <label>Pattern</label>
                            <select id="sectionC-polyPattern">
                                <option value="3:2">3:2 (Triplets over Duplets)</option>
                                <option value="4:3">4:3 (Four over Three)</option>
                                <option value="5:4" selected>5:4 (Five over Four)</option>
                                <option value="7:4">7:4 (Seven over Four)</option>
                                <option value="5:3">5:3 (Five over Three)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section D -->
        <div class="section-card" id="sectionD">
            <div class="section-header">
                <div class="section-title">Section D (Finale)</div>
                <div class="section-enabled">
                    <label>Enabled</label>
                    <input type="checkbox" id="sectionD-enabled" checked onchange="toggleSection('D')">
                </div>
            </div>
            
            <div class="section-content" id="sectionD-content">
                <div class="section-grid">
                    <div class="control-group">
                        <label>Tempo (BPM)</label>
                        <input type="number" id="sectionD-tempo" value="160" min="40" max="200">
                    </div>
                    <div class="control-group">
                        <label>Time Signature</label>
                        <select id="sectionD-timeSig">
                            <option value="4/4" selected>4/4</option>
                            <option value="3/4">3/4</option>
                            <option value="6/8">6/8</option>
                            <option value="5/4">5/4</option>
                            <option value="7/8">7/8</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Key</label>
                        <select id="sectionD-key">
                            <option value="C" selected>C Major</option>
                            <option value="G">G Major</option>
                            <option value="D">D Major</option>
                            <option value="A">A Major</option>
                            <option value="E">E Major</option>
                            <option value="F">F Major</option>
                            <option value="Bb">Bâ™­ Major</option>
                            <option value="Am">A Minor</option>
                            <option value="Em">E Minor</option>
                            <option value="Dm">D Minor</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Scale Type</label>
                        <select id="sectionD-scale">
                            <option value="major" selected>Major</option>
                            <option value="minor">Natural Minor</option>
                            <option value="harmonic-minor">Harmonic Minor</option>
                            <option value="dorian">Dorian</option>
                            <option value="phrygian">Phrygian</option>
                            <option value="lydian">Lydian</option>
                            <option value="mixolydian">Mixolydian</option>
                            <option value="pentatonic">Pentatonic</option>
                            <option value="blues">Blues</option>
                            <option value="chromatic">Chromatic</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Dynamics</label>
                        <select id="sectionD-dynamics">
                            <option value="pp">pp (pianissimo)</option>
                            <option value="p">p (piano)</option>
                            <option value="mp">mp (mezzo-piano)</option>
                            <option value="mf">mf (mezzo-forte)</option>
                            <option value="f">f (forte)</option>
                            <option value="ff" selected>ff (fortissimo)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Style</label>
                        <select id="sectionD-style">
                            <option value="classical" selected>Classical</option>
                            <option value="romantic">Romantic</option>
                            <option value="impressionist">Impressionist</option>
                            <option value="modern">Modern</option>
                            <option value="jazz">Jazz</option>
                            <option value="folk">Folk</option>
                            <option value="minimalist">Minimalist</option>
                        </select>
                    </div>
                    <div class="control-group full-width">
                        <label>Chord Progression</label>
                        <input type="text" id="sectionD-chords" class="chord-progression-input" value="I-IV-V-I" placeholder="e.g., I-V-vi-IV or C-G-Am-F">
                        <div class="help-text">Use Roman numerals or chord names</div>
                    </div>
                </div>

                <div class="instruments-section">
                    <div class="instruments-title">Instrument Settings</div>
                    <div class="instrument-row">
                        <div class="instrument-label">Guitar:</div>
                        <select id="sectionD-guitar">
                            <option value="strum" selected>Strumming</option>
                            <option value="fingerpicking">Fingerpicking</option>
                            <option value="arpeggios">Arpeggios</option>
                            <option value="powerchords">Power Chords</option>
                            <option value="melodic">Melodic</option>
                            <option value="muted">Muted</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Violin I:</div>
                        <select id="sectionD-violin1">
                            <option value="legato">Legato</option>
                            <option value="staccato">Staccato</option>
                            <option value="tremolo" selected>Tremolo</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="melodic">Melodic Lead</option>
                            <option value="harmonic">Harmonics</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Violin II:</div>
                        <select id="sectionD-violin2">
                            <option value="harmony">Harmony</option>
                            <option value="counter">Counter Melody</option>
                            <option value="rhythmic">Rhythmic</option>
                            <option value="tremolo" selected>Tremolo</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="doubling">Doubling</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Viola:</div>
                        <select id="sectionD-viola">
                            <option value="sustained">Sustained</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="rhythmic">Rhythmic</option>
                            <option value="melodic">Melodic</option>
                            <option value="tremolo" selected>Tremolo</option>
                            <option value="harmonic">Inner Harmony</option>
                        </select>
                    </div>
                    <div class="instrument-row">
                        <div class="instrument-label">Cello:</div>
                        <select id="sectionD-cello">
                            <option value="bassline">Bass Line</option>
                            <option value="arco">Arco Sustained</option>
                            <option value="pizzicato">Pizzicato</option>
                            <option value="melodic">Melodic</option>
                            <option value="pedal" selected>Pedal Tones</option>
                            <option value="walking">Walking Bass</option>
                        </select>
                    </div>
                </div>

                <div class="polyrhythm-section">
                    <div class="polyrhythm-title">Polyrhythmic Settings</div>
                    <div class="section-grid">
                        <div class="control-group">
                            <label>Enable Polyrhythm</label>
                            <input type="checkbox" id="sectionD-polyrhythm" style="width: 20px; height: 20px;">
                        </div>
                        <div class="control-group">
                            <label>Pattern</label>
                            <select id="sectionD-polyPattern">
                                <option value="3:2">3:2 (Triplets over Duplets)</option>
                                <option value="4:3">4:3 (Four over Three)</option>
                                <option value="5:4">5:4 (Five over Four)</option>
                                <option value="7:4">7:4 (Seven over Four)</option>
                                <option value="5:3">5:3 (Five over Three)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="generate-button" onclick="generateComposition()">ðŸŽµ Generate Quintet</button>

    <div id="output"></div>

    <script>
        function toggleSection(section) {
            const enabled = document.getElementById(`section${section}-enabled`).checked;
            const content = document.getElementById(`section${section}-content`);
            
            if (enabled) {
                content.classList.remove('section-disabled');
            } else {
                content.classList.add('section-disabled');
            }
        }

        function getSectionConfig(section) {
            const prefix = `section${section}`;
            
            return {
                enabled: document.getElementById(`${prefix}-enabled`).checked,
                tempo: parseInt(document.getElementById(`${prefix}-tempo`).value),
                timeSig: document.getElementById(`${prefix}-timeSig`).value,
                key: document.getElementById(`${prefix}-key`).value,
                scale: document.getElementById(`${prefix}-scale`).value,
                dynamics: document.getElementById(`${prefix}-dynamics`).value,
                style: document.getElementById(`${prefix}-style`).value,
                chords: document.getElementById(`${prefix}-chords`).value,
                instruments: {
                    guitar: document.getElementById(`${prefix}-guitar`).value,
                    violin1: document.getElementById(`${prefix}-violin1`).value,
                    violin2: document.getElementById(`${prefix}-violin2`).value,
                    viola: document.getElementById(`${prefix}-viola`).value,
                    cello: document.getElementById(`${prefix}-cello`).value
                },
                polyrhythm: {
                    enabled: document.getElementById(`${prefix}-polyrhythm`).checked,
                    pattern: document.getElementById(`${prefix}-polyPattern`).value
                }
            };
        }

        function getScaleNotes(key, scaleType) {
            const scales = {
                'major': [0, 2, 4, 5, 7, 9, 11],
                'minor': [0, 2, 3, 5, 7, 8, 10],
                'harmonic-minor': [0, 2, 3, 5, 7, 8, 11],
                'dorian': [0, 2, 3, 5, 7, 9, 10],
                'phrygian': [0, 1, 3, 5, 7, 8, 10],
                'lydian': [0, 2, 4, 6, 7, 9, 11],
                'mixolydian': [0, 2, 4, 5, 7, 9, 10],
                'pentatonic': [0, 2, 4, 7, 9],
                'blues': [0, 3, 5, 6, 7, 10],
                'chromatic': [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
            };
            
            const keyMap = {
                'C': 0, 'G': 7, 'D': 2, 'A': 9, 'E': 4, 'F': 5, 
                'Bb': 10, 'Am': 9, 'Em': 4, 'Dm': 2
            };
            
            const rootNote = keyMap[key] || 0;
            const scale = scales[scaleType] || scales['major'];
            
            return scale.map(interval => (rootNote + interval) % 12);
        }

        function parseChordProgression(progression, key) {
            const romanToInterval = {
                'I': 0, 'i': 0,
                'II': 2, 'ii': 2,
                'III': 4, 'iii': 4,
                'IV': 5, 'iv': 5,
                'V': 7, 'v': 7,
                'VI': 9, 'vi': 9,
                'VII': 11, 'vii': 11
            };
            
            const chords = progression.split('-').map(chord => {
                chord = chord.trim();
                if (romanToInterval[chord] !== undefined) {
                    return romanToInterval[chord];
                }
                // If not roman numeral, return 0 (tonic)
                return 0;
            });
            
            return chords.length > 0 ? chords : [0, 5, 7, 9]; // Default I-IV-V-vi
        }

        function generateGuitarChord(root, octave, pattern) {
            const chordNotes = [];
            
            // Build a 4-note chord
            if (pattern === 'powerchords') {
                // Power chord: root, fifth, octave
                chordNotes.push([root, octave]);
                chordNotes.push([(root + 7) % 12, octave]);
                chordNotes.push([root, octave + 1]);
            } else {
                // Regular chord: root, third, fifth, octave
                chordNotes.push([root, octave]);
                chordNotes.push([(root + 4) % 12, octave]); // Major third
                chordNotes.push([(root + 7) % 12, octave]); // Fifth
                chordNotes.push([root, octave + 1]); // Octave
            }
            
            return chordNotes;
        }

        function generatePolyrhythmicPattern(baseBeats, polyPattern) {
            const patterns = {
                '3:2': { numerator: 3, denominator: 2 },
                '4:3': { numerator: 4, denominator: 3 },
                '5:4': { numerator: 5, denominator: 4 },
                '7:4': { numerator: 7, denominator: 4 },
                '5:3': { numerator: 5, denominator: 3 }
            };
            
            const pattern = patterns[polyPattern] || patterns['3:2'];
            const result = [];
            
            for (let i = 0; i < baseBeats; i++) {
                const polyPosition = (i * pattern.numerator) / pattern.denominator;
                result.push(Math.floor(polyPosition) !== Math.floor(polyPosition - (pattern.numerator / pattern.denominator)));
            }
            
            return result;
        }

        function generateComposition() {
            const title = document.getElementById('title').value || 'Quintet';
            const composer = document.getElementById('composer').value || 'Composer';
            const measuresPerSection = parseInt(document.getElementById('measuresPerSection').value) || 4;
            
            // Get all section configurations
            const sections = ['A', 'B', 'C', 'D'];
            const sectionConfigs = {};
            let enabledSections = [];
            
            sections.forEach(section => {
                const config = getSectionConfig(section);
                if (config.enabled) {
                    sectionConfigs[section] = config;
                    enabledSections.push(section);
                }
            });
            
            if (enabledSections.length === 0) {
                alert('Please enable at least one section!');
                return;
            }
            
            // Generate MusicXML
            let xml = generateMusicXML(title, composer, sectionConfigs, enabledSections, measuresPerSection);
            
            // Display the XML
            document.getElementById('output').innerHTML = `
                <h2>Generated MusicXML</h2>
                <div id="xmlOutput">${escapeXml(xml)}</div>
                <button class="copy-button" onclick="copyToClipboard()">Copy MusicXML</button>
                <button class="copy-button" style="background: #2196F3;" onclick="downloadXML()">Export MusicXML</button>
            `;
        }

        function generateMusicXML(title, composer, sectionConfigs, enabledSections, measuresPerSection) {
            let xml = `<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE score-partwise PUBLIC "-//Recordare//DTD MusicXML 3.1 Partwise//EN" "http://www.musicxml.org/dtds/partwise.dtd">
<score-partwise version="3.1">
    <work>
        <work-title>${title}</work-title>
    </work>
    <identification>
        <creator type="composer">${composer}</creator>
        <encoding>
            <software>Quintet Composer V3.9</software>
            <encoding-date>${new Date().toISOString().split('T')[0]}</encoding-date>
        </encoding>
    </identification>
    <part-list>
        <part-group type="start" number="1">
            <group-symbol>bracket</group-symbol>
        </part-group>
        <score-part id="P1">
            <part-name>Guitar</part-name>
        </score-part>
        <score-part id="P2">
            <part-name>Violin I</part-name>
        </score-part>
        <score-part id="P3">
            <part-name>Violin II</part-name>
        </score-part>
        <score-part id="P4">
            <part-name>Viola</part-name>
        </score-part>
        <score-part id="P5">
            <part-name>Violoncello</part-name>
        </score-part>
        <part-group type="stop" number="1"/>
    </part-list>`;
            
            // Generate parts
            const instruments = ['guitar', 'violin1', 'violin2', 'viola', 'cello'];
            const partIds = ['P1', 'P2', 'P3', 'P4', 'P5'];
            
            partIds.forEach((partId, partIndex) => {
                xml += `\n    <part id="${partId}">`;
                
                let measureNumber = 1;
                
                enabledSections.forEach((section, sectionIndex) => {
                    const config = sectionConfigs[section];
                    
                    for (let m = 0; m < measuresPerSection; m++) {
                        xml += `\n        <measure number="${measureNumber}">`;
                        
                        // Add section-specific attributes at the start of each section
                        if (m === 0) {
                            // Add rehearsal mark
                            xml += `\n            <direction placement="above">
                <direction-type>
                    <rehearsal>${section}</rehearsal>
                </direction-type>
            </direction>`;
                            
                            // Add tempo marking
                            xml += `\n            <direction placement="above">
                <direction-type>
                    <metronome>
                        <beat-unit>quarter</beat-unit>
                        <per-minute>${config.tempo}</per-minute>
                    </metronome>
                </direction-type>
                <sound tempo="${config.tempo}"/>
            </direction>`;
                            
                            // Add dynamics
                            xml += `\n            <direction placement="below">
                <direction-type>
                    <dynamics>
                        <${config.dynamics}/>
                    </dynamics>
                </direction-type>
            </direction>`;
                            
                            // Add attributes
                            const [beats, beatType] = config.timeSig.split('/');
                            xml += `\n            <attributes>
                <divisions>4</divisions>
                <key>
                    <fifths>${getKeyFifths(config.key)}</fifths>
                </key>
                <time>
                    <beats>${beats}</beats>
                    <beat-type>${beatType}</beat-type>
                </time>`;
                            
                            // Add clef based on instrument
                            if (partIndex === 0) { // Guitar
                                xml += `\n                <clef>
                    <sign>G</sign>
                    <line>2</line>
                </clef>`;
                            } else if (partIndex === 3) { // Viola
                                xml += `\n                <clef>
                    <sign>C</sign>
                    <line>3</line>
                </clef>`;
                            } else if (partIndex === 4) { // Cello
                                xml += `\n                <clef>
                    <sign>F</sign>
                    <line>4</line>
                </clef>`;
                            } else { // Violins
                                xml += `\n                <clef>
                    <sign>G</sign>
                    <line>2</line>
                </clef>`;
                            }
                            
                            xml += `\n            </attributes>`;
                        }
                        
                        // Generate notes based on instrument and section configuration
                        const instrumentName = instruments[partIndex];
                        const instrumentStyle = config.instruments[instrumentName];
                        const scaleNotes = getScaleNotes(config.key, config.scale);
                        const chordProgression = parseChordProgression(config.chords, config.key);
                        
                        // Determine if polyrhythm applies to this measure
                        let polyPattern = null;
                        if (config.polyrhythm.enabled) {
                            polyPattern = generatePolyrhythmicPattern(4, config.polyrhythm.pattern);
                        }
                        
                        // Generate notes for this measure
                        if (partIndex === 0) { // Guitar
                            // Generate guitar chord for this measure
                            const chordIndex = m % chordProgression.length;
                            const chordRoot = chordProgression[chordIndex];
                            
                            // Generate two chords per measure (beats 1 and 3 in 4/4)
                            for (let chordBeat = 0; chordBeat < 2; chordBeat++) {
                                // Get the current chord root for this beat
                                const currentChordIndex = (m * 2 + chordBeat) % chordProgression.length;
                                const chordRoot = chordProgression[currentChordIndex];
                                
                                // Build proper 4-note guitar chord
                                const chordNotes = [];
                                
                                // Different voicings based on instrument style
                                if (instrumentStyle === 'powerchords') {
                                    // Power chord: root, fifth, octave
                                    chordNotes.push({ pitch: chordRoot, octave: 3 });
                                    chordNotes.push({ pitch: (chordRoot + 7) % 12, octave: 3 });
                                    chordNotes.push({ pitch: chordRoot, octave: 4 });
                                } else {
                                    // Full chord: root, third, fifth, octave
                                    chordNotes.push({ pitch: chordRoot, octave: 3 });
                                    chordNotes.push({ pitch: (chordRoot + 4) % 12, octave: 3 }); // Major third
                                    chordNotes.push({ pitch: (chordRoot + 7) % 12, octave: 3 }); // Fifth
                                    chordNotes.push({ pitch: chordRoot, octave: 4 }); // Octave
                                }
                                
                                // Write chord to XML
                                chordNotes.forEach((note, noteIndex) => {
                                    xml += '\n            <note>';
                                    
                                    // Add chord tag for all notes except the first
                                    if (noteIndex > 0) {
                                        xml += '\n                <chord/>';
                                    }
                                    
                                    const noteName = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'][note.pitch];
                                    const stepName = noteName.replace('#', '');
                                    const hasAlter = noteName.includes('#');
                                    
                                    xml += `\n                <pitch>
                    <step>${stepName}</step>${hasAlter ? '\n                    <alter>1</alter>' : ''}
                    <octave>${note.octave}</octave>
                </pitch>
                <duration>8</duration>
                <type>half</type>`;
                                    
                                    xml += '\n            </note>';
                                });
                            }
                        } else {
                            // Generate notes for string instruments
                            const octaveMap = {
                                'violin1': 4,
                                'violin2': 4,
                                'viola': 3,
                                'cello': 2
                            };
                            
                            const baseOctave = octaveMap[instrumentName];
                            
                            // Generate 4 notes per measure (quarter notes)
                            for (let beat = 0; beat < 4; beat++) {
                                const usePolyrhythm = polyPattern && polyPattern[beat];
                                
                                // Pick a note from the scale
                                const scaleIndex = Math.floor(Math.random() * scaleNotes.length);
                                const pitch = scaleNotes[scaleIndex];
                                const noteName = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'][pitch];
                                
                                // Vary octave based on instrument style
                                let octave = baseOctave;
                                if (instrumentStyle === 'melodic') {
                                    octave += Math.floor(Math.random() * 2);
                                }
                                
                                xml += `\n            <note>
                <pitch>
                    <step>${noteName.replace('#', '')}</step>
                    ${noteName.includes('#') ? '<alter>1</alter>' : ''}
                    <octave>${octave}</octave>
                </pitch>
                <duration>${usePolyrhythm ? '3' : '4'}</duration>
                <type>quarter</type>`;
                                
                                // Add articulation based on style
                                if (instrumentStyle === 'staccato') {
                                    xml += `\n                <articulations>
                    <staccato/>
                </articulations>`;
                                } else if (instrumentStyle === 'pizzicato') {
                                    xml += `\n                <articulations>
                    <pizzicato/>
                </articulations>`;
                                }
                                
                                xml += '\n            </note>';
                            }
                        }
                        
                        xml += '\n        </measure>';
                        measureNumber++;
                    }
                });
                
                xml += '\n    </part>';
            });
            
            xml += '\n</score-partwise>';
            return xml;
        }

        function getKeyFifths(key) {
            const fifths = {
                'C': 0, 'G': 1, 'D': 2, 'A': 3, 'E': 4, 'B': 5,
                'F': -1, 'Bb': -2, 'Eb': -3, 'Ab': -4, 'Db': -5,
                'Am': 0, 'Em': 1, 'Bm': 2, 'F#m': 3, 'C#m': 4,
                'Dm': -1, 'Gm': -2, 'Cm': -3, 'Fm': -4
            };
            return fifths[key] || 0;
        }

        function escapeXml(unsafe) {
            return unsafe.replace(/[<>&'"]/g, function (c) {
                switch (c) {
                    case '<': return '&lt;';
                    case '>': return '&gt;';
                    case '&': return '&amp;';
                    case '\'': return '&apos;';
                    case '"': return '&quot;';
                }
            });
        }

        function copyToClipboard() {
            const xmlOutput = document.getElementById('xmlOutput').textContent;
            const xml = xmlOutput.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&').replace(/&apos;/g, "'").replace(/&quot;/g, '"');
            navigator.clipboard.writeText(xml).then(() => {
                alert('MusicXML copied to clipboard!');
            });
        }

        function downloadXML() {
            const xmlOutput = document.getElementById('xmlOutput').textContent;
            const xml = xmlOutput.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&').replace(/&apos;/g, "'").replace(/&quot;/g, '"');
            const blob = new Blob([xml], { type: 'text/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'quintet-composition.musicxml';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>